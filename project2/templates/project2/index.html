{% extends 'base.html' %}
{% load static %}

{% block content %}

  {% if error %}
    <div style="padding:10px;border:1px solid #d33;background:#fee;color:#900;margin-bottom:1rem;">
      {{ error }}
    </div>
  {% endif %}
  {% if message %}
    <div style="padding:10px;border:1px solid #3a7;background:#efe;color:#063;margin-bottom:1rem;">
      {{ message }}
    </div>
  {% endif %}

  <h1>Project 2: Text Classification & Active Learning</h1>

  <!-- ========= TASK 1: PASSIVE TRAINING ========= -->
  <section>
    <h2>Task 1: Passive Text Classification</h2>
    <p>
      We train on 70% of the IMDB reviews (in <code>project2/data/imdb.csv(.gz)</code>)
      and test on the remaining 30%.<br/>
      <strong>Representation:</strong> TFâ€‘IDF (unigrams &amp; bigrams, top 20,000 features)<br/>
      <strong>Classifier:</strong> Logistic Regression
    </p>

    <form method="post">
      {% csrf_token %}
      <!-- keep this so older view versions still trigger the train branch -->
      <input type="hidden" name="train_submit" value="1">
      <button type="submit">Train / Retrain Model</button>
    </form>

    {% if train_accuracy is not None %}
      <p><strong>Test accuracy:</strong> {{ train_accuracy|floatformat:4 }}</p>
    {% endif %}
  </section>

  <hr/>

  <!-- ======= TASK 2: POOL-BASED ACTIVE LEARNING ======= -->
  <section>
    <h2>Task 2: Pool-based Active Learning</h2>
    <p>
      Starting from a small labeled seed, we query new labels using different strategies.<br/>
      The learning curve (test accuracy vs. # of queries) will appear below.
    </p>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="active_submit" value="1">

      <label>
        Initial labeled set size:
        <input type="number" name="init_size"
               value="{{ active_form.init_size|default:10 }}"
               min="1" required>
      </label>
      <br/>

      <label>
        Budget (# queries):
        <input type="number" name="budget"
               value="{{ active_form.budget|default:50 }}"
               min="1" required>
      </label>
      <br/>

      <label>
        Batch size:
        <input type="number" name="batch_size"
               value="{{ active_form.batch_size|default:1 }}"
               min="1" required>
      </label>
      <br/>

      <label>
        Strategy:
        <select name="strategy" required>
          <option value="random"      {% if active_form.strategy == "random" %}selected{% endif %}>Random</option>
          <option value="uncertainty" {% if active_form.strategy == "uncertainty" %}selected{% endif %}>Uncertainty</option>
          <option value="margin"      {% if active_form.strategy == "margin" %}selected{% endif %}>Margin</option>
          <option value="entropy"     {% if active_form.strategy == "entropy" %}selected{% endif %}>Entropy</option>
        </select>
      </label>
      <br/><br/>

      <button type="submit">Run Active Learning</button>
    </form>

    {% if active_curves %}
      <h3>Learning Curve</h3>
      <p>(Test accuracy vs. number of queries)</p>
      <img src="{% static 'plots/al_curve.png' %}" alt="AL Learning Curve" style="max-width:700px;width:100%;height:auto;">
    {% endif %}
  </section>

{% endblock %}
