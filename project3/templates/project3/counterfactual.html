{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'project2.css' %}">
{% endblock %}

{% block content %}
<div class="project2">

  <a href="{% url 'home:index' %}" class="home-button">Home</a>

  <section>
    <h1>Counterfactual Explanation</h1>

    <form method="post" class="form-block">
      {% csrf_token %}

      <label for="instance"><strong>Select an Instance:</strong></label>
      <select name="instance" id="instance" required>
        {% for idx, val in instance_options %}
          <option value="{{ idx }}" {% if selected_instance == idx %}selected{% endif %}>Instance {{ val }}</option>
        {% endfor %}
      </select>
      <br/>

      <label for="target"><strong>Target Class:</strong></label>
      <select name="target" id="target" required>
        {% for idx, label in label_options %}
          <option value="{{ idx }}" {% if selected_label == idx %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <br/>

      <label for="k"><strong>How many counterfactuals (k)?</strong></label>
      <input type="number" name="k" id="k" min="1" max="20" value="{{ k|default:5 }}" required>
      <br/>

      <button type="submit">Show Counterfactuals</button>
    </form>

    {% if error %}
      <div style="padding:10px;border:1px solid #d33;background:#fee;color:#900;margin-bottom:1rem;">
        {{ error }}
      </div>
    {% endif %}

    {% if prediction %}
      <div class="metrics">
        <div><strong>Instance Number:</strong> {{ instance_number }}</div>
        <div><strong>Original Prediction:</strong> {{ prediction }}</div>
        <div><strong>Target Label:</strong> {{ target }}</div>
      </div>

      <h3>Original Input</h3>
<ul class="nav-list">
  {% for key, value in original.items %}
    <li>{{ key }}: {{ value }}</li>
  {% endfor %}
</ul>

<style>
  .nav-list {
    list-style-type: none;
    padding-left: 0;
    margin: 0;
  }
</style>


      <h3>Top Counterfactuals</h3>
      {% if counterfactuals %}
        <div class="data-preview-container">
          <style>
            .data-preview-container { 
                width: 80% !important;              
                margin: 10px auto 30px !important;  
                max-height: 300px !important;
                padding: 12px !important;
                border: none !important;
                background: transparent !important;
                box-shadow: none !important;
                overflow-x: auto !important;
            }
            .data-preview-container table {
                width: 100% !important;              
                table-layout: fixed !important;      
                border-collapse: collapse !important;
                font-size: 11px !important;
                word-wrap: break-word !important;
                background: transparent !important;
            }
            .data-preview-container th,
            .data-preview-container td {
                padding: 4px 6px !important;
                border: 1px solid #ddd !important;
                text-align: center !important;
                font-size: 13px !important;
            }
          </style>
          <table>
            <thead>
              <tr>
                {% for key in counterfactuals.0.keys %}
                  <th>{{ key }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for row in counterfactuals %}
                <tr>
                  {% for value in row.values %}
                    <td>{{ value }}</td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p>No valid counterfactuals found.</p>
      {% endif %}
    {% endif %}

    <div style="margin-top:1.25rem;">
      <a href="{% url 'project3:index' %}" class="home-button">Back to Index</a>
    </div>
  </section>

</div>
{% endblock %}
